<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GRIP — Slope Slip Simulator</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --panel: #12121a;
    --border: #2a2a3a;
    --accent: #f0c040;
    --danger: #ff3a3a;
    --safe: #3aff8a;
    --text: #e0e0f0;
    --muted: #606080;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'IBM Plex Sans', sans-serif;
    min-height: 100vh;
    display: grid;
    grid-template-rows: auto 1fr auto;
    overflow-x: hidden;
  }

  header {
    padding: 20px 32px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: baseline;
    gap: 16px;
  }

  header h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.4rem;
    letter-spacing: 4px;
    color: var(--accent);
  }

  header span {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.75rem;
    color: var(--muted);
    letter-spacing: 2px;
  }

  main {
    display: grid;
    grid-template-columns: 300px 1fr 260px;
    gap: 0;
    height: calc(100vh - 100px);
  }

  .panel {
    background: var(--panel);
    border-right: 1px solid var(--border);
    padding: 24px;
    overflow-y: auto;
  }

  .panel:last-child { border-right: none; border-left: 1px solid var(--border); }

  .panel-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 3px;
    color: var(--accent);
    margin-bottom: 20px;
  }

  label {
    display: block;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.72rem;
    color: var(--muted);
    letter-spacing: 1px;
    margin-bottom: 6px;
    text-transform: uppercase;
  }

  .control-group { margin-bottom: 24px; }

  input[type="range"] {
    -webkit-appearance: none;
    width: 100%;
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    outline: none;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    background: var(--accent);
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.1s;
  }

  input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.3); }

  .value-display {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    color: var(--text);
    line-height: 1;
    margin-top: 6px;
  }

  .value-display small {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.7rem;
    color: var(--muted);
  }

  /* Tire compound selector */
  .compounds {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .compound-btn {
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text);
    padding: 12px 8px;
    cursor: pointer;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.75rem;
    letter-spacing: 1px;
    text-align: center;
    transition: all 0.15s;
    border-radius: 2px;
  }

  .compound-btn:hover { border-color: var(--accent); color: var(--accent); }

  .compound-btn.active {
    background: var(--accent);
    color: #000;
    border-color: var(--accent);
    font-weight: 600;
  }

  .compound-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin: 0 auto 6px;
  }

  /* Simulation canvas area */
  .sim-area {
    background: var(--bg);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
  }

  canvas {
    display: block;
  }

  .slip-banner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Bebas Neue', sans-serif;
    font-size: 5rem;
    color: var(--danger);
    letter-spacing: 8px;
    opacity: 0;
    pointer-events: none;
    text-shadow: 0 0 40px #ff3a3a88;
    transition: opacity 0.2s;
  }

  .slip-banner.show { opacity: 1; animation: flash 0.4s infinite alternate; }

  @keyframes flash { from { opacity: 1; } to { opacity: 0.4; } }

  /* Data panel */
  .data-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
  }

  .data-label {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.68rem;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .data-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.4rem;
    line-height: 1;
  }

  .data-value.good { color: var(--safe); }
  .data-value.warn { color: var(--accent); }
  .data-value.bad { color: var(--danger); }

  .grip-bar-wrap {
    margin-top: 16px;
  }

  .grip-bar-track {
    height: 8px;
    background: var(--border);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 6px;
  }

  .grip-bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.15s, background 0.3s;
  }

  .btn-run {
    width: 100%;
    margin-top: 20px;
    background: var(--accent);
    color: #000;
    border: none;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 3px;
    padding: 14px;
    cursor: pointer;
    border-radius: 2px;
    transition: background 0.15s, transform 0.1s;
  }

  .btn-run:hover { background: #ffd060; transform: translateY(-1px); }
  .btn-run:active { transform: translateY(0); }

  footer {
    border-top: 1px solid var(--border);
    padding: 10px 32px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.68rem;
    color: var(--muted);
    letter-spacing: 1px;
    display: flex;
    justify-content: space-between;
  }
</style>
</head>
<body>

<header>
  <h1>GRIP</h1>
  <span>SLOPE SLIP SIMULATOR v1.0</span>
</header>

<main>
  <!-- LEFT PANEL -->
  <div class="panel">
    <div class="panel-title">Parameters</div>

    <div class="control-group">
      <label>Slope Angle</label>
      <input type="range" id="angle" min="0" max="75" value="20" step="0.5">
      <div class="value-display" id="angle-display">20 <small>°</small></div>
    </div>

    <div class="control-group">
      <label>Vehicle Mass</label>
      <input type="range" id="mass" min="500" max="5000" value="1500" step="50">
      <div class="value-display" id="mass-display">1500 <small>kg</small></div>
    </div>

    <div class="control-group">
      <label>Surface Condition</label>
      <select id="surface" style="width:100%;background:var(--bg);border:1px solid var(--border);color:var(--text);padding:8px;font-family:'IBM Plex Mono',monospace;font-size:0.8rem;border-radius:2px;outline:none;">
        <option value="1.0">Dry Asphalt</option>
        <option value="0.7">Wet Asphalt</option>
        <option value="0.35">Packed Snow</option>
        <option value="0.15">Black Ice</option>
        <option value="0.55">Gravel</option>
        <option value="0.6">Wet Grass</option>
      </select>
    </div>

    <div class="control-group">
      <label>Tire Compound</label>
      <div class="compounds" id="compounds">
        <button class="compound-btn active" data-mu="1.0" data-name="SLICK">
          <div class="compound-dot" style="background:#e8e0d0"></div>SLICK
        </button>
        <button class="compound-btn" data-mu="0.85" data-name="SOFT">
          <div class="compound-dot" style="background:#ff4444"></div>SOFT
        </button>
        <button class="compound-btn" data-mu="0.75" data-name="MEDIUM">
          <div class="compound-dot" style="background:#f0c040"></div>MEDIUM
        </button>
        <button class="compound-btn" data-mu="0.65" data-name="HARD">
          <div class="compound-dot" style="background:#ffffff"></div>HARD
        </button>
        <button class="compound-btn" data-mu="0.55" data-name="WINTER">
          <div class="compound-dot" style="background:#88ccff"></div>WINTER
        </button>
        <button class="compound-btn" data-mu="0.3" data-name="BALD">
          <div class="compound-dot" style="background:#555555"></div>BALD
        </button>
      </div>
    </div>

    <button class="btn-run" id="runBtn">▶ RUN SIMULATION</button>
  </div>

  <!-- CANVAS -->
  <div class="sim-area">
    <canvas id="simCanvas"></canvas>
    <div class="slip-banner" id="slipBanner">SLIPPING!</div>
  </div>

  <!-- DATA PANEL -->
  <div class="panel">
    <div class="panel-title">Live Data</div>

    <div class="data-row">
      <div class="data-label">Slope Angle</div>
      <div class="data-value" id="d-angle">—</div>
    </div>
    <div class="data-row">
      <div class="data-label">Gravity Component<br>Down Slope</div>
      <div class="data-value" id="d-fdown">—</div>
    </div>
    <div class="data-row">
      <div class="data-label">Normal Force</div>
      <div class="data-value" id="d-fnorm">—</div>
    </div>
    <div class="data-row">
      <div class="data-label">Max Static Friction</div>
      <div class="data-value" id="d-ffrict">—</div>
    </div>
    <div class="data-row">
      <div class="data-label">Slip Threshold</div>
      <div class="data-value" id="d-thresh">—</div>
    </div>
    <div class="data-row">
      <div class="data-label">Status</div>
      <div class="data-value" id="d-status">—</div>
    </div>

    <div class="grip-bar-wrap">
      <label>Grip Margin</label>
      <div class="grip-bar-track">
        <div class="grip-bar-fill" id="gripBar" style="width:100%;background:var(--safe)"></div>
      </div>
    </div>

    <div style="margin-top:20px;padding:12px;background:var(--bg);border:1px solid var(--border);border-radius:2px;">
      <div style="font-family:'IBM Plex Mono',monospace;font-size:0.65rem;color:var(--muted);line-height:1.8;">
        <div style="color:var(--accent);margin-bottom:6px;letter-spacing:2px;">FORMULA</div>
        μ = tan(θ) → slip threshold<br>
        F_down = mg·sin(θ)<br>
        F_normal = mg·cos(θ)<br>
        F_friction = μ_tire × μ_surface × F_normal<br>
        <span style="color:var(--danger)">SLIP if F_down > F_friction</span>
      </div>
    </div>
  </div>
</main>

<footer>
  <span>Physics: μ_static × Normal Force vs Gravity Component</span>
  <span>bennett, co — grip sim</span>
</footer>

<script>
const canvas = document.getElementById('simCanvas');
const ctx = canvas.getContext('2d');

let animFrame = null;
let slipping = false;
let slipProgress = 0; // 0..1 how far down the car has slid
let simRunning = false;

// State
let state = {
  angle: 20,
  mass: 1500,
  surfaceMu: 1.0,
  tireMu: 1.0,
  tireName: 'SLICK'
};

const G = 9.81;

function computePhysics() {
  const theta = state.angle * Math.PI / 180;
  const fDown = state.mass * G * Math.sin(theta);
  const fNorm = state.mass * G * Math.cos(theta);
  const muCombined = state.tireMu * state.surfaceMu;
  const fFriction = muCombined * fNorm;
  const threshAngle = Math.atan(muCombined) * 180 / Math.PI;
  const isSlipping = fDown > fFriction;
  const gripMargin = fFriction > 0 ? Math.min(1, fFriction / fDown) : 0;
  return { fDown, fNorm, fFriction, threshAngle, isSlipping, gripMargin, muCombined };
}

function resize() {
  const area = canvas.parentElement;
  canvas.width = area.clientWidth;
  canvas.height = area.clientHeight;
}

resize();
window.addEventListener('resize', () => { resize(); draw(); });

function draw() {
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0, 0, W, H);

  const physics = computePhysics();
  const angleDeg = state.angle;
  const angleRad = angleDeg * Math.PI / 180;

  // Draw slope
  const slopeLength = Math.min(W, H) * 0.7;
  const cx = W * 0.5;
  const cy = H * 0.6;

  const x1 = cx - slopeLength * 0.5 * Math.cos(angleRad);
  const y1 = cy + slopeLength * 0.5 * Math.sin(angleRad);
  const x2 = cx + slopeLength * 0.5 * Math.cos(angleRad);
  const y2 = cy - slopeLength * 0.5 * Math.sin(angleRad);

  // Ground fill
  ctx.beginPath();
  ctx.moveTo(x1, y1);
  ctx.lineTo(x2, y2);
  ctx.lineTo(x2, H + 50);
  ctx.lineTo(x1, H + 50);
  ctx.fillStyle = '#16161f';
  ctx.fill();

  // Surface texture lines
  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(-angleRad);
  for (let i = -slopeLength/2; i < slopeLength/2; i += 20) {
    ctx.beginPath();
    ctx.moveTo(i, 0);
    ctx.lineTo(i, 40);
    ctx.strokeStyle = '#1e1e2e';
    ctx.lineWidth = 1;
    ctx.stroke();
  }
  ctx.restore();

  // Slope line
  ctx.beginPath();
  ctx.moveTo(x1, y1);
  ctx.lineTo(x2, y2);
  ctx.strokeStyle = '#3a3a5a';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Angle arc
  ctx.beginPath();
  ctx.arc(x1, y1, 50, -Math.PI, -Math.PI + angleRad, false);
  ctx.strokeStyle = '#f0c04055';
  ctx.lineWidth = 1.5;
  ctx.stroke();
  ctx.fillStyle = '#f0c040aa';
  ctx.font = '600 13px IBM Plex Mono';
  ctx.fillText(angleDeg + '°', x1 + 55, y1 - 10);

  // Car position on slope
  const carT = simRunning && slipping ? 0.7 - slipProgress * 0.5 : 0.65;
  const carX = x1 + (x2 - x1) * carT;
  const carY = y1 + (y2 - y1) * carT;

  // Draw car (sled shape)
  ctx.save();
  ctx.translate(carX, carY);
  ctx.rotate(-angleRad);

  const carW = 70, carH = 28;

  // Wheels
  const wheelColor = physics.isSlipping ? '#ff3a3a' : '#888';
  const wheelRadius = 10;

  // Tire compound color on wheel
  const tireColors = { SLICK:'#e8e0d0', SOFT:'#ff4444', MEDIUM:'#f0c040', HARD:'#ffffff', WINTER:'#88ccff', BALD:'#555555' };
  const tireColor = tireColors[state.tireName] || '#888';

  [-carW*0.3, carW*0.3].forEach(wx => {
    ctx.beginPath();
    ctx.arc(wx, carH/2, wheelRadius, 0, Math.PI * 2);
    ctx.fillStyle = '#222';
    ctx.fill();
    ctx.strokeStyle = tireColor;
    ctx.lineWidth = 3;
    ctx.stroke();

    // Wheel spin indicator when slipping
    if (simRunning && slipping) {
      ctx.beginPath();
      ctx.moveTo(wx, carH/2);
      ctx.lineTo(wx, carH/2 - wheelRadius + 2);
      ctx.strokeStyle = '#ff3a3a';
      ctx.lineWidth = 2;
      ctx.stroke();
    }
  });

  // Body
  ctx.beginPath();
  ctx.roundRect(-carW/2, -carH/2, carW, carH, 4);
  ctx.fillStyle = slipping ? '#2a1010' : '#1a1a2e';
  ctx.fill();
  ctx.strokeStyle = slipping ? '#ff3a3a' : '#3a3a6a';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Windshield
  ctx.beginPath();
  ctx.moveTo(carW/2 - 20, -carH/2);
  ctx.lineTo(carW/2 - 5, -carH/2 + 10);
  ctx.lineTo(carW/2 - 5, carH/2 - 10);
  ctx.strokeStyle = '#4a8aff44';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Status light on car
  ctx.beginPath();
  ctx.arc(0, -carH/2 - 5, 4, 0, Math.PI*2);
  ctx.fillStyle = slipping ? '#ff3a3a' : '#3aff8a';
  ctx.fill();
  ctx.shadowColor = slipping ? '#ff3a3a' : '#3aff8a';
  ctx.shadowBlur = 10;
  ctx.fill();
  ctx.shadowBlur = 0;

  ctx.restore();

  // Force vectors
  if (simRunning) {
    const scale = 0.04;
    const phy = physics;

    // Down-slope force (red)
    const fDownLen = phy.fDown * scale;
    ctx.beginPath();
    ctx.moveTo(carX, carY);
    ctx.lineTo(carX + Math.cos(-angleRad + Math.PI) * fDownLen, carY + Math.sin(-angleRad + Math.PI) * fDownLen);
    ctx.strokeStyle = '#ff3a3a';
    ctx.lineWidth = 2.5;
    ctx.setLineDash([]);
    ctx.stroke();
    drawArrow(ctx, carX + Math.cos(-angleRad + Math.PI) * fDownLen, carY + Math.sin(-angleRad + Math.PI) * fDownLen, -angleRad + Math.PI, '#ff3a3a');

    // Friction force (green, opposing)
    const fFrictLen = Math.min(phy.fFriction, phy.fDown + 2000) * scale;
    ctx.beginPath();
    ctx.moveTo(carX, carY);
    ctx.lineTo(carX + Math.cos(-angleRad) * fFrictLen, carY + Math.sin(-angleRad) * fFrictLen);
    ctx.strokeStyle = slipping ? '#ff7a00' : '#3aff8a';
    ctx.lineWidth = 2.5;
    ctx.stroke();
    drawArrow(ctx, carX + Math.cos(-angleRad) * fFrictLen, carY + Math.sin(-angleRad) * fFrictLen, -angleRad, slipping ? '#ff7a00' : '#3aff8a');

    // Normal force (blue)
    const fNormLen = phy.fNorm * scale * 0.5;
    const perpAngle = -angleRad - Math.PI/2;
    ctx.beginPath();
    ctx.moveTo(carX, carY);
    ctx.lineTo(carX + Math.cos(perpAngle) * fNormLen, carY + Math.sin(perpAngle) * fNormLen);
    ctx.strokeStyle = '#4a8aff';
    ctx.lineWidth = 2;
    ctx.stroke();
    drawArrow(ctx, carX + Math.cos(perpAngle) * fNormLen, carY + Math.sin(perpAngle) * fNormLen, perpAngle, '#4a8aff');

    // Legend
    const lx = 20, ly = 30;
    ctx.font = '12px IBM Plex Mono';
    [[`F_down = ${(phy.fDown/1000).toFixed(2)} kN`, '#ff3a3a'],
     [`F_friction = ${(phy.fFriction/1000).toFixed(2)} kN`, slipping ? '#ff7a00' : '#3aff8a'],
     [`F_normal = ${(phy.fNorm/1000).toFixed(2)} kN`, '#4a8aff']
    ].forEach(([text, color], i) => {
      ctx.fillStyle = color;
      ctx.fillText(text, lx, ly + i * 20);
    });
  }

  // Update data panel
  updateDataPanel(physics);
}

function drawArrow(ctx, x, y, angle, color) {
  ctx.save();
  ctx.translate(x, y);
  ctx.rotate(angle);
  ctx.beginPath();
  ctx.moveTo(0, 0);
  ctx.lineTo(-8, -5);
  ctx.lineTo(-8, 5);
  ctx.closePath();
  ctx.fillStyle = color;
  ctx.fill();
  ctx.restore();
}

function updateDataPanel(p) {
  const angleDeg = state.angle;
  document.getElementById('d-angle').textContent = angleDeg.toFixed(1) + '°';
  document.getElementById('d-fdown').textContent = (p.fDown / 1000).toFixed(2) + ' kN';
  document.getElementById('d-fnorm').textContent = (p.fNorm / 1000).toFixed(2) + ' kN';
  document.getElementById('d-ffrict').textContent = (p.fFriction / 1000).toFixed(2) + ' kN';
  document.getElementById('d-thresh').textContent = p.threshAngle.toFixed(1) + '°';

  const statusEl = document.getElementById('d-status');
  if (p.isSlipping) {
    statusEl.textContent = 'SLIPPING';
    statusEl.className = 'data-value bad';
  } else {
    const margin = (p.fFriction - p.fDown) / p.fFriction;
    if (margin < 0.15) {
      statusEl.textContent = 'CRITICAL';
      statusEl.className = 'data-value warn';
    } else {
      statusEl.textContent = 'HOLDING';
      statusEl.className = 'data-value good';
    }
  }

  const margin = Math.min(1, p.gripMargin);
  const bar = document.getElementById('gripBar');
  bar.style.width = (margin * 100) + '%';
  if (margin > 0.5) bar.style.background = 'var(--safe)';
  else if (margin > 0.2) bar.style.background = 'var(--accent)';
  else bar.style.background = 'var(--danger)';
}

function animateSlip() {
  const physics = computePhysics();
  slipping = physics.isSlipping;

  const banner = document.getElementById('slipBanner');
  if (slipping) {
    banner.classList.add('show');
    slipProgress = Math.min(1, slipProgress + 0.008);
  } else {
    banner.classList.remove('show');
    slipProgress = 0;
  }

  draw();
  animFrame = requestAnimationFrame(animateSlip);
}

// Controls
document.getElementById('angle').addEventListener('input', function() {
  state.angle = parseFloat(this.value);
  document.getElementById('angle-display').innerHTML = state.angle + ' <small>°</small>';
  if (!simRunning) draw();
});

document.getElementById('mass').addEventListener('input', function() {
  state.mass = parseFloat(this.value);
  document.getElementById('mass-display').innerHTML = state.mass + ' <small>kg</small>';
  if (!simRunning) draw();
});

document.getElementById('surface').addEventListener('change', function() {
  state.surfaceMu = parseFloat(this.value);
  if (!simRunning) draw();
});

document.querySelectorAll('.compound-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.compound-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    state.tireMu = parseFloat(this.dataset.mu);
    state.tireName = this.dataset.name;
    if (!simRunning) draw();
  });
});

document.getElementById('runBtn').addEventListener('click', function() {
  if (simRunning) {
    cancelAnimationFrame(animFrame);
    simRunning = false;
    slipping = false;
    slipProgress = 0;
    document.getElementById('slipBanner').classList.remove('show');
    this.textContent = '▶ RUN SIMULATION';
    draw();
  } else {
    simRunning = true;
    slipProgress = 0;
    this.textContent = '■ STOP SIMULATION';
    animateSlip();
  }
});

// Initial draw
draw();
</script>
</body>
</html> 
